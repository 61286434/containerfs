#parse("include_header.vm")
<div class="container">
    <!-- Page-Title -->
    <div class="row">
        <div class="col-sm-12">
            <h4 class="page-title">首页 - 数据概览</h4>
            <p class="text-muted page-title-alt">欢迎使用ContainerFS！</p>
        </div>
    </div>

    <!-- Table Content -->
    <div class="row">
        <!-- 最新拦截记录 -->
        <div class="col-lg-12">
            <div class="card-box">
                <div class="row">
                    <div class="col-sm-2" style="text-align: center">
                        <span style="font-size: 18px;">关键内容磁盘使用量</span><br/>
                        <span style="font-size: 18px;">剩余</span>
                        <span id="pathFree" style="font-size: 18px;color: #00aced"">$!{monitor.pathFreeStr}</span>
                        <span style="font-size: 18px;">G / 共</span>
                        <span id="pathTotal" style="font-size: 18px;">$!{monitor.pathTotalStr}</span>
                        <span style="font-size: 18px;">G</span>
                    </div>
                    <div class="col-sm-2" style="text-align: center">
                        <span style="font-size: 18px;">内存使用量</span><br/>
                        <span style="font-size: 18px;">剩余</span>
                        <span id="freeMem" style="font-size: 18px;color: #00aced"">$!{monitor.freeMemStr}</span>
                        <span style="font-size: 18px;">G</span>
                    </div>
                </div>
            </div>

        </div>

    </div><!-- end row -->

    <div class="row">
        <!-- CPU/内存/关键内容磁盘 使用率 折线图 -->
        <div class="col-lg-12">
            <div class="card-box">
                <div class="text-center">
                    <div id="percentChart" style="width: 100%;height:300px;"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- 内存信息 折线图 -->
        <div class="col-lg-12">
            <div class="card-box">
                <div class="text-center">
                    <div id="memoryChart" style="width: 100%;height:300px;"></div>
                </div>
            </div>
        </div>
    </div>

</div> <!-- container -->
#parse("include_footer.vm")

<script type="text/javascript">
    // IO图表，初始化echarts
    var percentChart = echarts.init(document.getElementById('percentChart'));

    var date = [];
    var cpuUsageData = [];
    var memUsedPercentData = [];
    var pathUsedPercentData = [];

    date.push('$!{monitor.date}');
    cpuUsageData.push('$!{monitor.cpuUsageStr}');
    memUsedPercentData.push('$!{monitor.memUsedPercentStr}');
    pathUsedPercentData.push('$!{monitor.pathUsedPercentStr}');

    // 指定图表的配置项和数据
    var percent_option = {
        title: {
            text: 'CPU/内存/关键内容磁盘 使用率(单位:%)',
            left: 'center'
        },
        color:[
            '#DC143C',
            '#00aced',
            '#32CD32'
        ],
        tooltip: {
            trigger: 'axis'
        },
        xAxis: {
            type: 'category',
            name: '时间',
            boundaryGap: false,
            splitLine: {show: false},
            data: date
        },
        yAxis: {
            type: 'value',
            name: '百分比',
            axisLabel: {
                show: true,
                interval: 'auto',
                formatter: '{value} %'
            },
        },
        series: [
            {
                name: 'CPU使用率',
                type: 'line',
                data: cpuUsageData
            },
            {
                name: '内存使用率',
                type: 'line',
                data: memUsedPercentData
            },
            {
                name: '关键内容磁盘使用率',
                type: 'line',
                data: pathUsedPercentData
            }
        ]
    };

    // 使用刚指定的配置项和数据显示图表。
    percentChart.setOption(percent_option);
</script>

<script type="text/javascript">
    // 内存图表，初始化echarts
    var memoryChart = echarts.init(document.getElementById('memoryChart'));

    var totalMemData = [];
    var usedMemData = [];
    totalMemData.push('$!{monitor.totalMemStr}');
    usedMemData.push('$!{monitor.usedMemStr}');

    // 指定图表的配置项和数据
    var memory_option = {
        title: {
            text: '内存信息(单位:MB)',
            left: 'center'
        },
        color:[
            '#00aced',
        ],
        color:[
            '#DC143C',
            '#00aced'
        ],
        tooltip: {
            trigger: 'axis'
        },
        xAxis: {
            type: 'category',
            name: '时间',
            boundaryGap: false,
            splitLine: {show: false},
            data: date
        },
        yAxis: {
            type: 'value',
            name: 'MB'
        },
        series: [
            {
                name: '总内存',
                type: 'line',
                data: totalMemData
            },
            {
                name: '已使用内存',
                type: 'line',
                data: usedMemData
            }
        ]
    };

    // 使用刚指定的配置项和数据显示图表。
    memoryChart.setOption(memory_option);
</script>
<script type="text/javascript">

    setInterval("dataNodeData()","5000");

    function dataNodeData(){
        $.ajax({
            url: "/datanode/data/$!ip/$!port",
            type: "GET",
            async:false,
            dataType: "json",
            async: false,
            error: function (request) {
            },
            success: function (json) {

                //设置使用率图表
                date.push(json.date)
                cpuUsageData.push(json.cpuUsageStr);
                memUsedPercentData.push(json.memUsedPercentStr);
                pathUsedPercentData.push(json.pathUsedPercentStr);

                percentChart.setOption({
                    xAxis: {
                        data: date
                    },
                    series: [
                        {
                            data: cpuUsageData
                        },
                        {
                            data: memUsedPercentData
                        },
                        {
                            data: pathUsedPercentData
                        }
                    ]
                });

                //设置内存图表
                totalMemData.push(json.totalMemStr);
                usedMemData.push(json.usedMemStr);

                memoryChart.setOption({
                    xAxis: {
                        data: date
                    },
                    series: [
                        {
                            data: totalMemData
                        },
                        {
                            data: usedMemData
                        },
                    ]
                });
            }
        });
    }

</script>